<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WiFi Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 400px;
      margin: 60px auto;
      padding: 20px;
      background: #fff;
      box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
      border-radius: 10px;
      text-align: center;
    }
    input, select {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 8px;
    }
    button:hover { background: #0056b3; }
    .logout-btn {
      background: #dc3545;
    }
    .logout-btn:hover { background: #a71d2a; }
    .hidden { display: none; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>

  <!-- Register Form -->
  <div class="container" id="registerContainer">
    <h2>Register Account</h2>
    <input type="email" id="registerEmail" placeholder="Email">
    <input type="password" id="registerPassword" placeholder="Password">
    <button id="registerBtn">Register</button>
    <p>Have an account? <a id="showLogin">Login here</a></p>
    <p id="registerMessage" style="color: red;"></p>
  </div>

  <!-- Login Form -->
  <div class="container hidden" id="loginContainer">
    <h2>WiFi Dashboard Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button id="loginBtn">Login</button>
    <p>No account? <a id="showRegister">Register here</a></p>
    <p id="loginMessage" style="color: red;"></p>
  </div>

  <!-- Dashboard -->
  <div class="container hidden" id="mainContent">
    <h2>WiFi User Dashboard</h2>

    <!-- Add User Form -->
    <input type="text" id="name" placeholder="User Name">
    <select id="plan">
      <option value="1 Month">1 Month</option>
      <option value="3 Months">3 Months</option>
      <option value="6 Months">6 Months</option>
    </select>
    <input type="date" id="expiry">
    <select id="status">
      <option value="Active">Active</option>
      <option value="Expired">Expired</option>
    </select>
    <button id="addUserBtn">Add User</button>
    <button class="logout-btn" id="logoutBtn">Logout</button>

    <!-- Table -->
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Plan</th>
          <th>Expiry</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { 
      getAuth, 
      createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, 
      onAuthStateChanged, 
      signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      deleteDoc,
      doc,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    // Firebase Config (မင်း project ရဲ့ config ထည့်ပါ)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // UI Elements
    const registerContainer = document.getElementById("registerContainer");
    const loginContainer = document.getElementById("loginContainer");
    const mainContent = document.getElementById("mainContent");

    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    const registerMessage = document.getElementById("registerMessage");
    const loginMessage = document.getElementById("loginMessage");

    const showLogin = document.getElementById("showLogin");
    const showRegister = document.getElementById("showRegister");

    const addUserBtn = document.getElementById("addUserBtn");
    const userTable = document.getElementById("userTable");

    // Switch Forms
    showLogin.addEventListener("click", () => {
      registerContainer.classList.add("hidden");
      loginContainer.classList.remove("hidden");
    });
    showRegister.addEventListener("click", () => {
      loginContainer.classList.add("hidden");
      registerContainer.classList.remove("hidden");
    });

    // Register
    registerBtn.addEventListener("click", async () => {
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;

      try {
        await createUserWithEmailAndPassword(auth, email, password);
        registerMessage.innerText = "✅ Register success! Please login.";
      } catch (error) {
        registerMessage.innerText = "❌ " + error.message;
      }
    });

    // Login
    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        loginMessage.innerText = "❌ " + error.message;
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // Add User to Firestore
    addUserBtn.addEventListener("click", async () => {
      const name = document.getElementById("name").value;
      const plan = document.getElementById("plan").value;
      const expiry = document.getElementById("expiry").value;
      const status = document.getElementById("status").value;

      if (!name || !expiry) return alert("Fill all fields");

      await addDoc(collection(db, "wifiUsers"), {
        name, plan, expiry, status
      });

      document.getElementById("name").value = "";
      document.getElementById("expiry").value = "";
    });

    // Real-time Load Users
    onSnapshot(collection(db, "wifiUsers"), (snapshot) => {
      userTable.innerHTML = "";
      snapshot.forEach((docu) => {
        const user = docu.data();
        const row = `
          <tr>
            <td>${user.name}</td>
            <td>${user.plan}</td>
            <td>${user.expiry}</td>
            <td>${user.status}</td>
            <td>
              <button onclick="deleteUser('${docu.id}')">Delete</button>
            </td>
          </tr>
        `;
        userTable.innerHTML += row;
      });
    });

    // Delete User
    window.deleteUser = async (id) => {
      await deleteDoc(doc(db, "wifiUsers", id));
    };

    // Auth State Listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        registerContainer.classList.add("hidden");
        loginContainer.classList.add("hidden");
        mainContent.classList.remove("hidden");
      } else {
        mainContent.classList.add("hidden");
        loginContainer.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
